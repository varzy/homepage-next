---
title: 'ä¸€ä¸ªå¾®ä¿¡å°ç¨‹åºçš„æ¸è¿›å¼ä¼˜åŒ–ä¹‹è·¯'
category: 'Coding'
type: 'Post'
status: 'Published'
tags: ['Miniprogram', 'Stylelint', 'ESLint', 'Prettier', 'Deploy']
date: '2022-01-25'
slug: 'miniprogram-turning'
summary: ''
last_edited_time: '2024-03-16T08:21:00.000Z'
blog_last_fetched_time: '2025-08-06T03:16:17.872Z'
notion_id: '60ab9222-edfb-4760-8b2e-d833f77638d8'
---

2022 å¹´ç¬¬ä¸€æ›´ï¼Œæ¥ä¸ªå¤§çš„ï¼

å…¥èŒæœç‹åæˆ‘å¼€å±•çš„ç¬¬ä¸€ä¸ªé¡¹ç›®å°±æ˜¯å¾®ä¿¡å°ç¨‹åºã€‚è°ˆèµ·å°ç¨‹åºå¼€å‘ï¼Œç”Ÿæ€å°é—­ã€å‘å¤šè·¯æ»‘ã€å¼€å‘å·¥å…·éš¾ç”¨ç­‰æ§½ç‚¹æ˜¯ä¸€å®šä¸èƒ½è¢«å¿½è§†çš„ï¼Œå› æ­¤å¸‚é¢ä¸Šä¹Ÿæ¶Œç°äº†ä¸€å¤§æ‰¹è¯¸å¦‚ mpvueã€taro è¿™æ ·çš„æŠ½è±¡ç¨‹åº¦æ›´é«˜çš„å°ç¨‹åºå¼€å‘æ¡†æ¶ã€‚æˆ‘è´Ÿè´£çš„è¿™ä¸ªå°ç¨‹åºé¡¹ç›®å¹¶æ²¡æœ‰é‡‡ç”¨è¿™äº›ç¬¬ä¸‰æ–¹æ¡†æ¶ï¼Œè€Œæ˜¯é€‰æ‹©åœ¨åŸç”ŸæŠ€æœ¯æ ˆçš„åŸºç¡€ä¸Šè¿›è¡Œäº†ä¸€ç³»åˆ—çš„ä¼˜åŒ–å’Œå®šåˆ¶ã€‚

å»å¹´ 8 æœˆä»½ (2021.08)ï¼Œå°ç¨‹åºçš„ç‰ˆæœ¬å·²ç»æ¥åˆ°äº† 4.0.0ã€‚ç»å†äº†é•¿è¾¾ä¸€å¹´çš„æ¸è¿›å¼ä¼˜åŒ–ï¼Œè¿™ä¸ªå°ç¨‹åºé¡¹ç›®çš„å¼€å‘ä½“éªŒä¹Ÿå‹‰å¼ºè¾¾åˆ°äº†â€œå¥½ç”¨â€çš„æ°´å¹³ï¼Œäºæ˜¯æˆ‘å†™ä¸‹äº†æœ¬æ–‡å¹¶åœ¨ç»„å†…åšäº†æŠ€æœ¯åˆ†äº«ã€‚æŠ€æœ¯åˆ†äº«åæˆ‘å°±æƒ³æ‰¾æ—¶é—´æŠŠæ–‡ç« è„±æ•å¹¶å…¬å¼€ï¼Œç»“æœæ‹–å»¶ç—‡å‘ä½œä¸€ç›´é¸½ğŸ•Šï¸åˆ°äº† 2022 å¹´ã€‚ã€‚ã€‚ä»Šå¤©ç»ˆäºç‹ ä¸‹å¿ƒæ¥é‡æ–°æ¢³ç†äº†è¿™ç¯‡ä¸‡å­—é•¿æ–‡ï¼Œå¸Œæœ›èƒ½å¸®åŠ©åˆ°éœ€è¦å¼€å‘å°ç¨‹åºçš„ä½ ã€‚

ç« èŠ‚æ¯”è¾ƒå¤šï¼Œå¯ä»¥ç‚¹å‡»ç›®å½•å¿«é€Ÿè·³è½¬ï¼›åŠ  â­ï¸ è¡¨ç¤ºä¸ªäººè®¤ä¸ºæ”¶ç›Šæ¯”è¾ƒå¤§çš„ä¼˜åŒ–ã€‚

## æˆ‘ä¿¡å¥‰çš„å‡ æ¡ä»£ç å“²å­¦

- è°¨è®°ä»£ç æ˜¯ç»™äººçœ‹çš„ï¼Œå®ƒä»¬åªæ˜¯æ°å¥½èƒ½è·‘è€Œå·²
- å¥å£®çš„ç»“æ„è¿œæ¯”ç²¾å·§çš„è®¾è®¡æ¥å¾—é‡è¦ã€‚æ¢å¥è¯è¯´ï¼Œç»“æ„æ˜¯ç¬¬ä¸€ä½çš„ï¼ŒåŠŸèƒ½æ˜¯ç¬¬äºŒä½çš„ã€‚ â€”â€”ã€Šå¤§æ•™å ‚ä¸é›†å¸‚ã€‹
- ä¿æŒé¡¹ç›®çš„ç®€å•æ€§ã€‚è®¾è®¡è¾¾åˆ°å®Œç¾çš„æ—¶å€™ï¼Œä¸æ˜¯æ— æ³•å†å¢åŠ ä¸œè¥¿äº†ï¼Œè€Œæ˜¯æ— æ³•å†å‡å°‘ä¸œè¥¿äº†ã€‚ â€”â€”ã€Šå¤§æ•™å ‚ä¸é›†å¸‚ã€‹

## å¼€å‘ä¹‹å‰

æˆ‘å·²ç»ä¸æ¥è§¦å°ç¨‹åºå¾ˆä¹…äº†ï¼Œä½†æ—¢ç„¶è¦ä»å¤´åšä¸€ä¸ªè¿˜ç®—å¤æ‚çš„å°ç¨‹åºï¼Œé‚£å°±è¦å…ˆç»™è‡ªå·±çº¦æ³•ä¸‰ç« ã€‚

### ä½¿ç”¨åŸç”ŸæŠ€æœ¯æ ˆï¼Œæ‹’ç»ç¬¬ä¸‰æ–¹æ¡†æ¶

å°ç¨‹åºæ›´æ–°èŠ‚å¥å¾ˆå¿«ï¼Œè€Œä¸”ä¸ä¹å„ç§ Breaking Changesï¼Œå¾ˆå¤šç¬¬ä¸‰æ–¹æ¡†æ¶ä¸èƒ½å®Œç¾ Follow è¿™äº›æ›´æ–°ï¼Œä»¥è‡³äºä¸€äº›æ—©å¹´é—´å¤§ç«çš„æ¡†æ¶åˆ°ç°åœ¨éƒ½ä¸å†ç»´æŠ¤ã€‚è€Œä¸”å°ç¨‹åºæŠ€æœ¯ç»å†å‡ å¹´çš„æ›´æ–°ï¼Œå·²ç»æ¯”åˆšæ¨å‡ºçš„æ—¶å€™å¼ºå¤§å¾ˆå¤šäº†ï¼Œå¦‚æœæ²¡æœ‰å¼ºçƒˆçš„è·¨å¹³å°éœ€æ±‚ï¼Œä½¿ç”¨åŸç”ŸæŠ€æœ¯æ ˆæˆ–è®¸æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚

### å…¨é¢æ‹¥æŠ± ES6+ è¯­æ³•ï¼›Promisify æ‰€æœ‰çš„ wx API

å°ç¨‹åºå¼€å‘è€…å·¥å…·å·²ç»æ”¯æŒç»å¤§éƒ¨åˆ†æˆ‘ä»¬æ—¥å¸¸èƒ½ä½¿ç”¨åˆ°çš„ ES6+ è¯­æ³•äº†ï¼Œå¹¶ä¸”ä¹Ÿæ”¯æŒäº†ç›®å‰å¤„ç†å›è°ƒæœ€å¸¸ç”¨çš„ async await è¯­æ³•ã€‚ä½†å®˜æ–¹çš„ `wx.showLoading` ç­‰ API éƒ½è¿˜æ˜¯åªèƒ½ä½¿ç”¨å›è°ƒï¼Œå› æ­¤å¼€å‘ä¸šåŠ¡å‰çš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯è®©æ‰€æœ‰çš„å¾®ä¿¡ API æ”¯æŒ Promise å½¢å¼è°ƒç”¨ã€‚

æœ€åæˆ‘çš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨äº†å¾®ä¿¡å®˜æ–¹æä¾›çš„ wxp åº“ï¼š[API Promise åŒ–](https://developers.weixin.qq.com/miniprogram/dev/extended/utils/api-promise.html)ã€‚

<details>
<summary>Example</summary>

```javascript
// utils/wxp.js
import { promisifyAll, promisify } from 'miniprogram-api-promise';

const wxp = {};
promisifyAll(wx, wxp);
promisify(wx.getUserProfile);

export { wxp };
export default wxp;

// page.js
import { wxp } from '../../utils/wxp';

await wxp.showModal({ showCancel: false, title: 'æç¤º', content: errMsg });
```

</details>

> ğŸ’¡ æ³¨æ„ï¼šä»åŸºç¡€åº“ 2.10.2 å¼€å§‹ï¼Œå¤§éƒ¨åˆ† API å°±å·²ç»åŸç”Ÿæ”¯æŒè¿”å› Promiseï¼Œå› æ­¤æœªæ¥æˆ‘ä¼šåœ¨é¡¹ç›®ä¸­é€æ­¥ç§»é™¤ wxp åº“ã€‚è¯¦è§æ–‡æ¡£ï¼š[å¼‚æ­¥ API è¿”å› Promise](https://developers.weixin.qq.com/miniprogram/dev/framework/app-service/api.html#API)ã€‚

### æ‹¥æŠ±æ¨¡å—åŒ–ï¼Œç®€åŒ– app.js

é¡¹ç›®ä¸­çš„å…¬å…±å†…å®¹ï¼Œæ¯”å¦‚é…ç½®ã€å·¥å…·å‡½æ•°ç­‰ï¼Œå…¨éƒ¨æŒ‰ç…§æ¨¡å—æ‹†åˆ†ï¼Œå¹¶å€Ÿç”± ES6 ä¸­çš„æ¨¡å—ç³»ç»Ÿå®ç°å¤ç”¨ï¼Œè€Œä¸æ˜¯ä¸€è‚¡è„‘å¡è¿› app.js ä¸­ã€‚æ€»ä¹‹ï¼Œè¿˜æ˜¯é«˜å†…èšä½è€¦åˆï¼Œä¿è¯å…¨å±€æ¨¡å—æ˜¯â€œè–„â€çš„ã€‚

<details>
<summary>Example</summary>

```javascript
// utils ç›®å½•æ”¶å½•äº†å„ç§è¾…åŠ©å·¥å…·
â”œâ”€â”€ utils
â”‚Â Â  â”œâ”€â”€ Auth.js
â”‚Â Â  â”œâ”€â”€ event-bus.js
â”‚Â Â  â”œâ”€â”€ helpers.js
â”‚Â Â  â”œâ”€â”€ http.js
â”‚Â Â  â”œâ”€â”€ logger.js
â”‚Â Â  â”œâ”€â”€ md5.js
â”‚Â Â  â””â”€â”€ wxp.js


// page.js
// âœ…
import { logger } from '../../utils/logger';
logger.log('...');

// âŒ
const app = getApp();
app.logger.log('...');
```

</details>

### ç¡®å®šå°ç¨‹åºç‰ˆæœ¬æ ¼å¼

ä¸¥æ ¼éµå®ˆ [SemVer è§„èŒƒ](https://semver.org/lang/zh-CN/)ã€‚

<details>
<summary>ç®€ä»‹</summary>

```markdown
ä¸»ç‰ˆæœ¬å·ï¼šå½“ä½ åšäº†ä¸å…¼å®¹çš„ API ä¿®æ”¹ï¼Œ
æ¬¡ç‰ˆæœ¬å·ï¼šå½“ä½ åšäº†å‘ä¸‹å…¼å®¹çš„åŠŸèƒ½æ€§æ–°å¢ï¼Œ
ä¿®è®¢å·ï¼šå½“ä½ åšäº†å‘ä¸‹å…¼å®¹çš„é—®é¢˜ä¿®æ­£ã€‚
```

</details>

### ç¼–å†™ CHANGELOG

åœ¨é¡¹ç›®ä¸­æ·»åŠ  `CHANGELOG.md`ï¼Œè®°å½•æ¯ä¸ªç‰ˆæœ¬çš„æ›´æ–°å†…å®¹ã€‚

<details>
<summary>Example</summary>

```markdown
## 3.3.0 (2021.08.16)

- A æ–°å¢ ç§¯åˆ†å•†åŸæ¨¡å—
- I ä¼˜åŒ– åˆ†äº«åˆ°æœ‹å‹åœˆåŠŸèƒ½
- I ä¼˜åŒ– å°ç¨‹åºä½“ç§¯ï¼Œæå‡å°ç¨‹åºæ‰“å¼€é€Ÿåº¦ï¼Œä¸»åŒ…ä½“ç§¯ç¼©å° 42% (950KB å‡å°åˆ° 549KB)
- I å‡çº§ å¯Œæ–‡æœ¬è§£æå™¨ç‰ˆæœ¬
- I ä¼˜åŒ– vant ç»„ä»¶åº“å‡çº§è„šæœ¬ã€vant ç»„ä»¶åº“å‘å¸ƒè„šæœ¬å’Œå°ç¨‹åºè‡ªåŠ¨ä¸Šä¼ è„šæœ¬
- F ä¿®å¤ é¦–é¡µå¼¹çª—çš„å¼‚å¸¸æ ·å¼
```

</details>

## ä½¿ç”¨ Prettier + .editorconfig è¿›è¡Œä»£ç æ ¼å¼åŒ–

ä»£ç æ ¼å¼åŒ–æ˜¯å›¢é˜Ÿåä½œå¼€å‘çš„åŸºçŸ³ä¹‹ä¸€ï¼Œ[Editorconfig](https://editorconfig.org/) å¯ä»¥æ¶ˆé™¤ä¸åŒå¼€å‘æˆå‘˜å› ä¸ºä»£ç ç¼–è¾‘å™¨å¸¦æ¥çš„é£æ ¼å·®å¼‚ï¼›è€Œ [Prettier](https://prettier.io/) æ˜¯ç›®å‰æœ€æµè¡Œçš„å‰ç«¯ä»£ç æ ¼å¼åŒ–å·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ·»åŠ ä¸€äº›è§„åˆ™ä½¿å…¶é€‚ç”¨äºæˆ‘ä»¬çš„å¾®ä¿¡å°ç¨‹åºé¡¹ç›®ã€‚

<details>
<summary>`.editorconfig`</summary>

```text
root = true

[*]
charset = utf-8
end_of_line = lf
indent_style = space
indent_size = 2
tab_width = 2
trim_trailing_whitespace = true
insert_final_newline = true

[*.md]
trim_trailing_whitespace = false
```

</details>

<details>
<summary>`.prettierrc.js`</summary>

```javascript
module.exports = {
  singleQuote: true,
  printWidth: 100,
  trailingComma: 'none',
  arrowParens: 'avoid',
  overrides: [
    {
      files: '*.wxml',
      options: { parser: 'html' },
    },
    {
      files: '*.wxss',
      options: { parser: 'css' },
    },
    {
      files: '*.wxs',
      options: { parser: 'babel', quoteProps: 'preserve' },
    },
  ],
};
```

</details>

<details>
<summary>`package.json`</summary>

```json
"scripts": {
  "lint:prettier": "prettier --loglevel warn --write \"src/**/*.{wxml,wxss,scss,wxs,json,md}\"",
},
```

</details>

## â­ï¸ æ‹†åˆ†è¯·æ±‚å±‚å’Œæ¥å£å±‚ï¼Œå®ç°æ¥å£ç®¡ç†å’Œå¤ç”¨

å¯¹ `wx.request` è¿›è¡Œå°è£…ï¼Œæ”¯æŒï¼š

- æ˜¯å¦è‡ªåŠ¨å¼€å¯é¡µé¢ Loading
- æ˜¯å¦è‡ªåŠ¨æ˜¾ç¤ºé”™è¯¯æç¤º
- è‡ªå®šä¹‰é”™è¯¯æç¤ºå†…å®¹
- æ˜¯å¦è‡ªåŠ¨æºå¸¦ Token
- æ·»åŠ è‡ªå®šä¹‰æ‹¦æˆªå™¨
  <details>
<summary>`utils/http.js`</summary>

```javascript
import { Auth } from './Auth';

/**
 * @param {Boolean} withToken æ˜¯å¦åœ¨å‘é€è¯·æ±‚æ—¶é™„å¸¦ auth token
 * @param {Boolean} showLoading æ˜¯å¦åœ¨å‘é€è¯·æ±‚æ—¶æ˜¾ç¤º loading
 * @param {Boolean} showError æ˜¯å¦åœ¨è¯·æ±‚å¤±è´¥æ—¶æ˜¾ç¤ºå¼‚å¸¸æç¤º(ä»…é’ˆå¯¹ success æ–¹æ³•)
 * @param {String} errorMsg é»˜è®¤çš„é”™è¯¯æç¤º(ä»…é’ˆå¯¹ success æ–¹æ³•)
 * @param {Function} successInterceptor è¯·æ±‚æˆåŠŸæ—¶çš„æ‹¦æˆªå™¨ï¼Œå¯ä»¥è‡ªå®šä¹‰åç»­é€»è¾‘
 * @param {Function} failInterceptor è¯·æ±‚å¤±è´¥æ—¶çš„æ‹¦æˆªå™¨ï¼Œå¯ä»¥è‡ªå®šä¹‰åç»­é€»è¾‘
 *
 * @NOTICE: å¾®ä¿¡å°ç¨‹åºçš„ fail åªåœ¨è¯·æ±‚å‘é€å¤±è´¥æ—¶è§¦å‘ï¼Œå› æ­¤å¯¹äºçŠ¶æ€ç çš„åˆ¤æ–­éœ€è¦æ”¾åœ¨ success æ–¹æ³•é‡Œå¤„ç†
 */
export default ({
  withToken = false,
  showLoading = true,
  loadingMsg = 'åŠ è½½ä¸­...',
  showError = true,
  errorMsg = 'è¯·æ±‚é”™è¯¯ï¼Œè¯·ç¨å€™å†è¯•',
  ...options
}) =>
  /* eslint-disable no-async-promise-executor */
  new Promise(async (resolve, reject) => {
    // å¼€å¯ loading
    if (showLoading) wx.showLoading({ title: loadingMsg, mask: true });

    // åœ¨ header ä¸­æ·»åŠ  token
    const header = options.header || { 'Content-Type': 'application/json' };
    if (withToken && Auth.isLogged()) {
      if (Auth.shouldRefreshToken()) await Auth.refreshToken();
      header['X-SA-AUTH'] = Auth.getToken();
    }

    // å‘é€è¯·æ±‚
    wx.request({
      ...options,
      header: Object.assign(header, options['header'] || {}),
      success: (res) => {
        if (showLoading) wx.hideLoading();

        if (options.successInterceptor) {
          options.successInterceptor(res, resolve, reject);
          return;
        }

        const statusCode = +res.statusCode;

        // 200: æ­£å¸¸æƒ…å†µ
        if (statusCode === 200) {
          resolve(res);
        } else {
          if (showError) {
            let finalMsg;
            // 404
            if (statusCode === 404) {
              finalMsg = 'èµ„æºä¸å­˜åœ¨';
            }
            // 500
            else if (statusCode === 500) {
              finalMsg = 'æœåŠ¡å™¨å¼€å°å·®äº†ï¼Œè¯·ç¨å€™é‡è¯•';
            }
            // 429
            else if (statusCode === 429) {
              finalMsg = 'æ‚¨è¯·æ±‚çš„å¤ªé¢‘ç¹äº†ï¼Œè¯·ç¨å€™é‡è¯•';
            }
            // æƒé™ç›¸å…³
            else if (
              res.data &&
              res.data.code &&
              ['invalid_auth_token', 'auth_token_expired', 'missing_auth_token', 'user_login_status_error'].includes(
                res.data.code,
              )
            ) {
              Auth.clearToken();
              const msgRelation = {
                invalid_auth_token: 'ç™»å½•çŠ¶æ€å·²å¤±æ•ˆï¼Œè¯·é‡è¯•',
                auth_token_expired: 'ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡è¯•',
                missing_auth_token: 'æœªèƒ½è·å–åˆ°æ‚¨çš„ç™»å½•å‡­è¯ï¼Œè¯·é‡è¯•',
                user_login_status_error: 'ç™»å½•çŠ¶æ€å¼‚å¸¸ï¼Œè¯·é‡è¯•',
              };
              finalMsg = res.data.code ? msgRelation[res.data.code] : 'ç™»å½•çŠ¶æ€å¼‚å¸¸ï¼Œè¯·é‡è¯•';
            }
            // å…¶ä»–æƒ…å†µ
            else {
              finalMsg = errorMsg;
            }

            wx.showToast({ title: finalMsg, icon: 'none', duration: 1500 });
          }

          reject(res);
        }
      },
      fail: (err) => {
        if (showLoading) wx.hideLoading();

        if (options.failInterceptor) {
          options.failInterceptor(err, resolve, reject);
          return;
        }

        wx.showToast({ title: 'è¯·æ±‚å‘é€å¤±è´¥ï¼Œè¯·ç¨å€™é‡è¯•', icon: 'none', duration: 1500 });

        reject(err);
      },
    });
  });
```

</details>

è€Œæ‰€æœ‰çš„æ¥å£è¯·æ±‚éƒ½å°è£…æˆå¼‚æ­¥æ–¹æ³•æ”¾ç½®åœ¨ api æ–‡ä»¶å¤¹ä¸‹è¿›è¡Œç»Ÿä¸€ç®¡ç†ã€‚

<details>
<summary>`api/goods.js`</summary>

```javascript
import http from '../utils/http';
// buildUrl æ˜¯ä¸€ä¸ªè‡ªè¡Œå®ç°çš„ï¼Œå¯ä»¥æ ¹æ®å°ç¨‹åºè¿è¡Œç¯å¢ƒè‡ªåŠ¨è®¡ç®—æµ‹è¯•ç¯å¢ƒ or æ­£å¼ç¯å¢ƒçš„æ–¹æ³•
import { buildUrl } from '../utils/helpers';

// è·å–å•†å“åˆ—è¡¨
export const reqFetchGoods = (data, showLoading = true) =>
  http({
    url: buildUrl(`/goods`),
    method: 'GET',
    data,
    showLoading,
  });

// è·å–å•†å“è¯¦æƒ…
export const reqShowGoods = (goodsId, showLoading = true) =>
  http({
    url: buildUrl(`/goods/${goodsId}`),
    method: 'GET',
    showLoading,
  });
```

</details>

## â­ï¸ app.js å’Œ page.js é—´çš„æ•°æ®äº¤äº’

è¿›å…¥å°ç¨‹åºåï¼Œapp.js å’Œ page.js ä¼šåŒæ—¶æ‰§è¡Œï¼Œè¿™å°±å¯¼è‡´å‡å¦‚ page.js ä¸­éœ€è¦æ‹¿åˆ°ä¸€äº› app.js ä¸­çš„æ•°æ®æ—¶ï¼Œå¿…é¡»ç»™å…¨å±€çš„ `app` å¯¹è±¡æ·»åŠ ä¸€ä¸ªå›è°ƒï¼Œå¹¶ä¸”åœ¨ app.js ä¸­åˆ¤æ–­æ˜¯å¦å­˜åœ¨è¿™ä¸ªå›è°ƒã€‚å°ç¨‹åºå¼€å‘è€…å·¥å…·ç»™å‡ºçš„ Demo é¡¹ç›®ä¸­å°±å¯ä»¥çœ‹åˆ°ä½¿ç”¨è¿™ç§é€»è¾‘æ¥åœ¨é¡µé¢ä¸­è·å–ç”¨æˆ·ä¿¡æ¯ã€‚**ä½†æ˜¯è¿™ç§æ–¹å¼éå¸¸ç¹çï¼Œä¼šå¯¼è‡´ page.js å’Œ app.js ä¸­å›è°ƒæ»¡å¤©é£ï¼Œéš¾ä»¥ç»´æŠ¤ã€‚**

è€Œæˆ‘çš„è§£å†³æ€è·¯æ˜¯ï¼Œåœ¨ app.js ä¸­å®šä¹‰ç»Ÿä¸€çš„å›è°ƒå‡½æ•°ï¼Œæ¯”å¦‚ä¸“é—¨ç”¨äºè·å–ç”¨æˆ·ä¿¡æ¯çš„ `getUserInfo(cb)` å‡½æ•°ï¼Œå‚æ•° cb æ˜¯é¡µé¢ä¼ å…¥çš„å›è°ƒå‡½æ•°ã€‚åœ¨ app.js ä¸­åˆ¤æ–­ç”¨æˆ·ä¿¡æ¯æ˜¯å¦å·²åˆå§‹åŒ–å®Œæ¯•ï¼Œå¦‚æœå·²å®Œæ¯•åˆ™ç›´æ¥æ‰§è¡Œé¡µé¢å›è°ƒï¼›åä¹‹åˆ™å…ˆå°† cb æš‚å­˜ï¼Œç­‰å¾…ç”¨æˆ·ä¿¡æ¯åˆå§‹åŒ–å®Œæ¯•åç»Ÿä¸€æ‰§è¡Œå›è°ƒã€‚å¦‚æ­¤ä¸€æ¥ï¼Œæˆ‘ä»¬å¯¹äºä»»ä½•éœ€è¦è·å–ç”¨æˆ·ä¿¡æ¯çš„éœ€æ±‚éƒ½å¯ä»¥é€šè¿‡ `app.getUserInfo` è¿™ä¸€ä¸ªå…¥å£è§£å†³ã€‚

<details>
<summary>`app.js`</summary>

```javascript
App({
  globalData: {
    isUserInfoInited: false,
    userInfoListeners: [],
    isLogged: false,
    userInfo: null,
  },

  async onLaunch(options) {
    this.initAppInfo(options);
  },

  async initUserInfo(reLogin = false) {
    // ä»æœªèµ°è¿‡ç™»å½•é€»è¾‘ï¼Œæˆ–å¼ºåˆ¶è¦æ±‚é‡æ–°ç™»å½•
    if (!Auth.isLoginActionCompleted() || reLogin) {
      // Auth.login ç”¨äºè·å–ç”¨æˆ·ä¿¡æ¯å¹¶ä¿å­˜åœ¨æœ¬åœ°
      await Auth.login();
    }

    this.globalData.isLogged = Auth.isLogged();
    this.globalData.userInfo = Auth.getUserInfo();

    // æ‰§è¡Œ getUserInfo æ–¹æ³•ä¸­æš‚å­˜çš„å›è°ƒå‡½æ•°
    this.globalData.isUserInfoInited = true;
    this.globalData.userInfoListeners.forEach((listener) => {
      listener(
        new IAppUserInfo({
          isLogged: this.globalData.isLogged,
          userInfo: this.globalData.userInfo,
        }),
      );
    });
    this.globalData.userInfoListeners = [];
  },
  getUserInfo(cb) {
    if (this.globalData.isUserInfoInited) {
      cb(
        new IAppUserInfo({
          isLogged: this.globalData.isLogged,
          userInfo: this.globalData.userInfo,
        }),
      );
    } else {
      this.globalData.userInfoListeners.push(cb);
    }
  },
  async getUserInfoAsync() {
    return new Promise((resolve) => this.getUserInfo(resolve));
  },
});
```

</details>

<details>
<summary>`page.js`</summary>

```javascript
async onLoad(options) {
  app.getUserInfo(({ userInfo }) => {
    // æ­¤æ—¶ userInfo ä¸€å®šæœ‰å€¼
    this.setData({
      userNickname: userInfo.nickname,
      avatar: userInfo.avatar
    });
  });
},
```

</details>

> ğŸ’¡ é™¤äº†åœ¨é¡µé¢å†…å¼‚æ­¥è·å–ç”¨æˆ·ä¿¡æ¯è¿™ç§éœ€æ±‚ï¼Œä½ è¿˜å¯ä»¥ç”¨ç±»ä¼¼çš„æ€è·¯æŠŠä¸€äº›å˜åŠ¨ä¸é¢‘ç¹çš„è®¡ç®—æ”¾åˆ° app.js é‡Œï¼Œæ¯”å¦‚è‡ªå®šä¹‰å¯¼èˆªæ çš„é«˜åº¦ã€ä¸€äº›ç”¨æˆ·æ‰‹æœºç›¸å…³çš„ç³»ç»Ÿä¿¡æ¯ç­‰ï¼Œå¯ä»¥æ˜¾è‘—æé«˜æ€§èƒ½ã€‚

## é€‰ç”¨ Vant Weapp æ›¿æ¢ WeUIï¼Œå¹¶ç¼–å†™è„šæœ¬è¿›è¡Œç»´æŠ¤

åœ¨é¡¹ç›®å¼€å‘åˆæœŸï¼Œæˆ‘ä»¬ä½¿ç”¨äº†å®˜æ–¹æ‰©å±• WeUI ç»„ä»¶åº“ (ä¸»è¦æ˜¯ä½¿ç”¨äº† Icon å›¾æ ‡ç»„ä»¶)ã€‚å…¶ä¼˜ç‚¹æ˜¯å¾®ä¿¡å†…ç½®ï¼Œå°ç¨‹åºå¼•å…¥æ—¶ä¸ä¼šé¢å¤–å¢åŠ å°ç¨‹åºä½“ç§¯ã€‚ä½†åæ¥å‘ç° WeUI ç»„ä»¶åº“ä»ä¸èƒ½æ»¡è¶³å¼€å‘éœ€æ±‚ï¼Œè°ƒç ”åå†³å®šå¼•å…¥ [Vant Weapp](https://youzan.github.io/vant-weapp/#/home) ç»„ä»¶åº“æ›¿ä»£ WeUIã€‚

æˆ‘ä»¬çš„é¡¹ç›®åªéœ€è¦ç”¨åˆ°å…¶ä¸­ä¸€éƒ¨åˆ†ç»„ä»¶ï¼Œæ¯”å¦‚å›¾æ ‡ç»„ä»¶ Iconï¼Œè¯„åˆ†ç»„ä»¶ Rate ç­‰ï¼Œå› æ­¤æˆ‘ä»¬æœ€å¥½è¿›è¡ŒæŒ‰éœ€å¼•å…¥ã€‚å®ç°æ–¹å¼ä¹Ÿå¾ˆç®€å•ï¼ŒæŠŠ Vant Weapp ç¼–è¯‘å¥½çš„ dist ç›®å½•ä¸­éœ€è¦ç”¨åˆ°çš„å„ä¸ªç»„ä»¶æ–‡ä»¶å¤¹ç›´æ¥å¤åˆ¶åˆ°é¡¹ç›®ä¸­å³å¯ã€‚å› æ­¤åœ¨é¡¹ç›®ä¸­æ–°å»ºäº† `vendor/vant` æ–‡ä»¶å¤¹å­˜æ”¾éœ€è¦ç”¨åˆ°çš„ Vant ç»„ä»¶ã€‚

è™½ç„¶å¬èµ·æ¥ç®€å•ï¼Œä½†å®é™…å­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼š

- å¦‚æœè¦æŒ‰ç…§æŒ‰éœ€åŠ è½½çš„æ–¹å¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¸èƒ½ä½¿ç”¨ npm å®‰è£… Vant Weappï¼Œå¦åˆ™ç¼–è¯‘åå°ç¨‹åºä¼šæœ‰å…¨é‡ç»„ä»¶ï¼Œä½“ç§¯è¿‡å¤§
- ä½¿ç”¨çš„ Vant Weapp å¿…é¡»ç‰ˆæœ¬ç»Ÿä¸€ï¼Œä¸èƒ½å‡ ä¸ªæœˆåæ·»åŠ æ–°çš„ç»„ä»¶ï¼Œå’Œä¹‹å‰æ·»åŠ çš„ç»„ä»¶ç‰ˆæœ¬ä¸ä¸€è‡´

æˆ‘çš„è§£å†³æ–¹æ¡ˆæ˜¯å°† Vant Weapp çš„æ„å»ºäº§ç‰© dist ç›®å½•çº³å…¥ç‰ˆæœ¬ç®¡ç†ï¼Œå¹¶ä¸”ç¼–å†™è„šæœ¬å®ç°ä¸€é”®æ›´æ–°å’Œå‘å¸ƒã€‚æˆ‘å¹¶ä¸æ“…é•¿ Shell è„šæœ¬ï¼Œå› æ­¤å¼•å…¥äº† [shelljs](https://www.npmjs.com/package/shelljs), [chalk](https://www.npmjs.com/package/chalk), [commander.js](https://www.npmjs.com/package/commander) è¿™ä¸‰ä¸ªåº“è¾…åŠ©æˆ‘ä½¿ç”¨ JS ä»£ç ç¼–å†™è„šæœ¬ã€‚

<details>
<summary>`cli/vant-upgrade.js`</summary>

```javascript
const shell = require('shelljs');
const chalk = require('chalk');
const path = require('path');

shell.cd(path.resolve(__dirname, '../'));

// å…‹éš†æœ€æ–°ç‰ˆæœ¬çš„ vant é¡¹ç›®æºç 
console.log(chalk.blue(`Downloading...`));
shell.exec(`git clone https://github.com/youzan/vant-weapp.git vant-source --depth=1`);
console.log(chalk.green(`Downloaded!`));

// ç”Ÿæˆæ–°çš„ vant é¡¹ç›®æ–‡ä»¶å¤¹
console.log(chalk.blue(`Migrating...`));
shell.rm('-rf', 'vant');
shell.mv('vant-source/dist', 'vant');
shell.mv('vant-source/package.json', 'vant/package.json');
shell.rm('-rf', 'vant-source');
console.log(chalk.green(`Migrated!`));

console.log(chalk.green(`Upgrade Success! Please republish the components you need.`));
```

</details>

<details>
<summary>`cli/vant-publish.js`</summary>

```javascript
const shell = require('shelljs');
const chalk = require('chalk');
const { Command } = require('commander');
const path = require('path');

const program = new Command();
program.requiredOption('-n --folder-names <names...>', 'Component folders you need.').parse(process.argv);
const options = program.opts();
const folderNames = options.folderNames;

folderNames.forEach((name) => {
  shell.rm('-rf', path.resolve(__dirname, `../src/vendor/vant/${name}`));
  shell.cp('-R', path.resolve(__dirname, `../vant/${name}`), path.resolve(__dirname, `../src/vendor/vant/${name}`));
  console.log(chalk.blue(`Component ${name} has been published.`));
});

console.log(chalk.green(`All components have been published!`));
```

</details>

<details>
<summary>`package.json`</summary>

```json
"scripts": {
  "vant:upgrade": "node cli/vant-upgrade.js",
  "vant:publish": "node cli/vant-publish.js",
},
```

</details>

## â­ï¸ å¼•å…¥ ESLint å®ç° JS ä»£ç æ£€æŸ¥

å°ç¨‹åºåœ¨å®Œæˆä¸€æœŸéœ€æ±‚åå·¥ç¨‹å°±å·²ç»å¾ˆå¤§äº†ï¼Œä¸ºäº†ç»§ç»­æé«˜é¡¹ç›®ç¨³å®šæ€§ï¼Œæˆ‘å†³å®šå¼•å…¥ ESLint å®ç°ä»£ç æ£€æŸ¥ã€‚

æœ‰å‡ ä¸ªé‡ç‚¹ï¼š

- è¦æŠŠä¸éœ€è¦æ£€æŸ¥çš„ç¬¬ä¸‰æ–¹åº“ç­‰æ·»åŠ è‡³ `.eslintignore` è¿›è¡Œå¿½ç•¥ï¼Œæ¯”å¦‚ Vant ç»„ä»¶åº“
- å¯ä»¥é€šè¿‡æ·»åŠ  `eslint-config-prettier` å’Œ `eslint-plugin-prettier` æ’ä»¶ï¼Œå°† Prettier å’Œ ESLint ç»“åˆèµ·æ¥ä½¿ç”¨
  <details>
<summary>`.eslintrc.js`</summary>

```javascript
module.exports = {
  env: {
    browser: true,
    node: true,
    es6: true,
    commonjs: true,
  },
  extends: ['eslint:recommended', 'plugin:prettier/recommended'],
  parser: '@babel/eslint-parser',
  parserOptions: {
    ecmaVersion: 6,
    sourceType: 'module',
  },
  globals: {
    App: true,
    Page: true,
    Component: true,
    Behavior: true,
    wx: true,
    getApp: true,
    getCurrentPages: true,
  },
  rules: {
    'no-unused-vars': 'warn',
    'prettier/prettier': 'warn',
  },
};
```

</details>

## å¼•å…¥ (ä¸€ç‚¹éƒ½ä¸å¥½ç”¨çš„) å•å…ƒæµ‹è¯•

å•å…ƒæµ‹è¯•ä¹Ÿæ˜¯æé«˜ä»£ç è´¨é‡çš„é‡è¦æ‰‹æ®µä¹‹ä¸€ï¼Œå› æ­¤æˆ‘ä¹Ÿå°è¯•åœ¨é¡¹ç›®ä¸­å¼•å…¥å®˜æ–¹çš„å•å…ƒæµ‹è¯•åŠŸèƒ½ã€‚è¯¦æƒ…æ–‡æ¡£ï¼š[å•å…ƒæµ‹è¯•](https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/unit-test.html)ã€‚ä½†è‡³å°‘åœ¨æˆ‘çœ‹æ¥ï¼Œå°ç¨‹åºçš„å•å…ƒæµ‹è¯•åŠŸèƒ½çœŸçš„éå¸¸éš¾ç”¨ï¼Œè€Œä¸”æ–‡æ¡£æåº¦ç®€é™‹ï¼Œç›®å‰ä¸ªäººè®¤ä¸ºè¿™é¡¹åŠŸèƒ½ä»å¤„äºå¯ç”¨æ€§ä¸å¼ºçš„é˜¶æ®µã€‚

<details>
<summary>Example</summary>

```javascript
import simulate from 'miniprogram-simulate';
import { randomStr } from '../utils';
import { CompSpec } from '../CompSpec';

const { compId, specDesc } = new CompSpec('components/no-data/no-data');

describe(specDesc, () => {
  test('Has default text', () => {
    const comp = simulate.render(compId);
    expect(comp.querySelector('.text').dom.innerHTML).toBe('ç›®å‰è¿˜æ²¡æœ‰æ•°æ®');
  });

  test('Show correct text', () => {
    const putText = randomStr();
    const comp = simulate.render(compId, { text: putText });
    expect(comp.querySelector('.text').dom.innerHTML).toEqual(putText);
  });
});
```

</details>

## â­ï¸ è®¾ç½®ç‹¬ç«‹çš„è·³è½¬ä¸­é—´é¡µ

å°ç¨‹åºä¸­æœ‰å¾ˆå¤šå¯ä»¥è¿›è¡Œåˆ†äº«çš„é¡µé¢ï¼Œå¦‚åŠ©åŠ›é¡µã€æ´»åŠ¨é¡µç­‰ï¼›ä»¥åŠä¸€å¤§æ‰¹æ¶ˆæ¯æ¨é€åç”¨æˆ·å¯ä»¥ç‚¹å‡»æ¶ˆæ¯å¡ç‰‡æ‰“å¼€çš„é¡µé¢ï¼Œè¿™äº›é¡µé¢éœ€è¦åç«¯ä»£ç é…ç½®å¯¹åº”çš„é¡µé¢è·¯å¾„ï¼Œè€Œæ¯å½“å°ç¨‹åºç«¯æ–‡ä»¶å¤¹ç»“æ„å˜åŒ–æ—¶ï¼Œåç«¯ä»£ç ä¹Ÿéœ€è¦è·Ÿç€æ”¹å˜ï¼Œéå¸¸éº»çƒ¦ã€‚

éšç€è¿™äº›å…¥å£è¶Šæ¥è¶Šå¤šï¼Œè·³è½¬çš„ç»´æŠ¤æ„ˆå‘å¤æ‚ï¼Œå› æ­¤æˆ‘å†³å®šå¼•å…¥ä¸€ä¸ªä¸“é—¨çš„ä¸­é—´é¡µé¢ (`/pages/portal/portal`) å¤„ç†å…¨éƒ¨è·³è½¬è¡Œä¸ºã€‚

ä¸ç®¡æ˜¯å‰ç«¯ç”Ÿäº§çš„åˆ†äº«é“¾æ¥ï¼Œè¿˜æ˜¯åç«¯ä»£ç é…ç½®çš„ç›®æ ‡è·¯å¾„ï¼Œæ°¸è¿œéƒ½æŒ‡å‘ Portal é¡µã€‚å°ç¨‹åºè¿›å…¥ Portalé¡µåï¼Œé¡µé¢å†æ ¹æ®å‚æ•° pk (æ„ä¸º PageKey) åœ¨å°ç¨‹åºç«¯è¿›è¡Œä¸€æ¬¡é‡å®šå‘ã€‚

<details>
<summary>`/pages/portal/portal.js`</summary>

```javascript
import { urlParamsToObj } from '../../utils/helpers';

Component({
  methods: {
    onLoad(pageOptions) {
      let optionsObj = null;
      let adapters = null;

      const launchOptions = wx.getLaunchOptionsSync();
      // å°ç¨‹åºæ˜¯æ‰«ç è¿›å…¥
      if (launchOptions.scene === 1047) {
        optionsObj = urlParamsToObj(decodeURIComponent(pageOptions.scene));
        adapters = {
          // 1001 => å°ç¨‹åºæ‰«ç æ‰“å¼€æ´»åŠ¨è¯¦æƒ…é¡µã€‚ä¾‹ï¼šscene=encodeURIComponent('?pk=1001&goodsId=${number}')
          1001: this._adaptToActivityDetailByQrcode,
        };
      }
      // éæ‰«ç è¿›å…¥
      else {
        optionsObj = pageOptions;
        adapters = {
          // 1002 => å‰å¾€é¡µé¢ Aã€‚ä¾‹ï¼š?pk=1002&goodsId=${number}
          1002: this._adaptToPageA,
          // 1003 => å‰å¾€é¡µé¢ Bã€‚ä¾‹ï¼š?pk=1003&userId=${number}
          1003: this._adaptToPageB,
        };
      }

      const { pk, ...options } = optionsObj;
      adapters[pk] ? adapters[pk](options) : reLaunch('Index');
    },
    _adaptToActivityDetailByQrcode(options) {
      reLaunch('ActivityDetail', `?goodsId=${options.goodsId}&pageFrom=PORTAL`);
    },
    _adaptToPageA(options) {
      reLaunch('A', `?goodsId=${options.goodsId}&pageFrom=PORTAL`);
    },
    _adaptToPageB(options) {
      reLaunch('B', `?userId=${options.userId}&pageFrom=PORTAL`);
    },
  },
});
```

</details>

## â­ï¸â­ï¸ å°ç¨‹åºä¸€é”®ä¸Šä¼  & ç‰ˆæœ¬ç®¡ç†

åœ¨å°ç¨‹åºç¨³æ­¥è¿­ä»£åŠå¹´ä¹‹é™…ï¼Œæˆ‘å®åœ¨æ˜¯å—å¤Ÿäº†æ¯æ¬¡éƒ½è¦ä»å¼€å‘è€…å·¥å…·ä¸­ç‚¹å‡»ä¸Šä¼ æŒ‰é’®ã€å¡«å†™ç‰ˆæœ¬å·ã€å‘å¸ƒçš„æ“ä½œã€‚å¥½åœ¨å¾®ä¿¡æä¾›äº†å®˜æ–¹çš„ [CI å·¥å…·](https://developers.weixin.qq.com/miniprogram/dev/devtools/ci.html)ï¼Œå› æ­¤æˆ‘å†³å®šç¼–å†™ä¸€ä¸ªè„šæœ¬å®ç°å°ç¨‹åºçš„ä¸€é”®ä¸Šä¼ åŠŸèƒ½ï¼Œå¹¶ä¸”è¿™ä¸ªè„šæœ¬æœ€å¥½èƒ½å¤Ÿä¸€é”®ç»´æŠ¤å°ç¨‹åºç‰ˆæœ¬ã€‚

æ€è·¯å°±æ˜¯å°ç¨‹åºé¡¹ç›®å†…æ”¾ç½®ä¸€ä¸ª env.js æ–‡ä»¶ï¼Œå®ƒä¸“é—¨å‘å¤–æŠ›å‡ºé¡¹ç›®çš„è¿è¡Œç¯å¢ƒå’Œç‰ˆæœ¬å·ä¿¡æ¯è¿™ä¸¤ä¸ªå˜é‡ï¼Œæ‰€æœ‰çš„æ¥å£ã€é…ç½®ç­‰éœ€è¦åŒºåˆ†ç¯å¢ƒçš„æ—¶å€™ï¼Œéƒ½å¯¼å…¥ env.js ä¸­çš„å˜é‡è¿›è¡ŒåŒºåˆ†ã€‚è€Œ env.js åˆ™ç”±ä¸Šä¼ è„šæœ¬è‡ªåŠ¨ç”Ÿæˆå¹¶ç»´æŠ¤ã€‚

è„šæœ¬å¹¶ä¸å¤æ‚ï¼Œä¹Ÿåªéœ€è¦æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼š`-e` å’Œ `-s`ã€‚-e è¡¨ç¤ºå°†è¦ä¸Šä¼ çš„å°ç¨‹åºçš„ç¯å¢ƒï¼Œæ”¯æŒ dev, staging å’Œ prod ä¸‰ç§ï¼Œåˆ†åˆ«å¯¹åº”å¼€å‘ã€é¢„å‘å¸ƒå’Œæ­£å¼ï¼›-s åˆ™å¯ä»¥ç»™ä¸‰ä½çš„æ­£å¼ç‰ˆæœ¬å·åé¢æ·»åŠ ä¸€ä¸ªå­ç‰ˆæœ¬å·ï¼Œä¸»è¦ç”¨äºåœ¨å›¢é˜Ÿå†…éƒ¨æ²Ÿé€šã€æµ‹è¯•æ—¶ä½¿ç”¨ï¼Œæ¯”å¦‚æµ‹è¯•åŒäº‹å¯ä»¥è®°å½• V4.3.0.1 å‘ç°çš„é—®é¢˜ï¼Œè€Œå¼€å‘äººå‘˜ä¿®å¤ååˆ™å¯ä»¥å‘å¸ƒä¸€ä¸ª V4.3.0.2 çš„æ–°ç‰ˆæœ¬ä»¥ä¾›å›æµ‹ã€‚æ­£å¼ä¸Šçº¿æ—¶åˆ™ä½¿ç”¨ V4.3.0 è¿™ä¸ªä¸‰ä½ç‰ˆæœ¬å·ã€‚

<details>
<summary>`cli/upload.js`</summary>

```javascript
const shell = require('shelljs');
const chalk = require('chalk');
const { Command } = require('commander');
const ci = require('miniprogram-ci');
const { appid } = require('../project.config.json');
const { version: mainVersion } = require('../package.json');
const path = require('path');

const program = new Command();
program
  .option('-e, --env <type>', 'The environment you want run', 'dev')
  .option('-s, --sub-version <number>', 'Sub version', '1')
  .parse(process.argv);
const options = program.opts();
const env = options.env.toUpperCase();
const subVersion = options.subVersion;

if (!['DEV', 'STAGING', 'PROD'].includes(env)) {
  console.error(chalk.red(`Required option '-e, --env' must be one of 'dev', 'staging' or 'prod'.`));
  return;
}
const fullVersion = env === 'PROD' ? `${env}-${mainVersion}` : `${env}-${mainVersion}-${subVersion}`;
const envFileCtx = `export const ENV = '${env}';
export const VERSION = '${fullVersion}';
`;

// é‡æ–°ç¼–è¯‘å°ç¨‹åº
shell.exec('cross-env NODE_ENV=production npx gulp build');
// éœ€è¦åŒæ—¶å†™å…¥ src å’Œ dist ä¸¤ä¸ªç›®å½•
shell.ShellString(envFileCtx).to(path.resolve(__dirname, '../src/config/env.js'));
shell.ShellString(envFileCtx).to(path.resolve(__dirname, '../dist/config/env.js'));

console.log(chalk.blue(`Ready to upload...`));

const project = new ci.Project({
  appid,
  type: 'miniProgram',
  projectPath: path.resolve(__dirname, '../dist'),
  privateKeyPath: path.resolve(__dirname, '../upload.private.key'),
  ignores: ['**/*.d.ts', '**/*.md'],
});

(async () => {
  await ci.upload({
    project,
    version: fullVersion,
    desc: `Uploaded at ${new Date().toLocaleString()}`,
    setting: {
      es6: true,
      es7: true,
      minify: true,
      autoPrefixWXSS: true,
    },
    onProgressUpdate() {},
  });

  console.log(chalk.green(`Upload Success! New Version: "${fullVersion}".`));

  process.exit();
})();
```

</details>

<details>
<summary>ä»£ç ä¸­ä½¿ç”¨</summary>

```javascript
// config/env.js
import { ENV } from './env';

export const BASE_URL_API = ENV === 'DEV' ? 'http://prod.com' : 'https://dev.com';
```

</details>

> ğŸ’¡ å…³äºè„šæœ¬ä¸­çš„ `npx gulp build` ç­‰å‘½ä»¤è¯·ç»“åˆä¸‹æ–‡çš„ _**å¼•å…¥ Gulp å·¥ä½œæµ**_ ä¸€èŠ‚ã€‚

## è®¾ç½®å¼€å‘äººå‘˜å’Œæµ‹è¯•äººå‘˜ä¸“ç”¨çš„è¾…åŠ©é¡µé¢

åœ¨å°ç¨‹åºå¼€å‘è¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸€äº›åŠŸèƒ½å¯èƒ½æ˜¯å¼€å‘äººå‘˜å’Œæµ‹è¯•äººå‘˜å¸¸ç”¨çš„ï¼Œæ¯”å¦‚æŸ¥çœ‹å½“å‰ç”¨æˆ·ä¿¡æ¯ã€ä¸€é”®æ¸…ç©ºç¼“å­˜ã€è·å–æ–°çš„ login code ç­‰ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å¼€å‘ä¸€ä¸ªä¸“ç”¨çš„é¡µé¢å­˜æ”¾è¿™äº›åŠŸèƒ½ï¼Œè€Œå…¥å£åˆ™ä¾æ®å°ç¨‹åºè¿è¡Œç¯å¢ƒå†³å®šæ˜¯å¦éšè—ã€‚

æˆ‘åœ¨å°ç¨‹åºé¦–é¡µçš„å·¦ä¸‹è§’æ·»åŠ äº†ä¸€ä¸ªå°è§’æ ‡ï¼Œç”¨äºæ ‡è®°å½“å‰å°ç¨‹åºçš„ç‰ˆæœ¬å·å’Œç¯å¢ƒã€‚è§’æ ‡å…·æœ‰é²œæ˜çš„èƒŒæ™¯è‰²ï¼Œå¼€å‘ç¯å¢ƒæ˜¯ç»¿è‰²ï¼Œé¢„å‘å¸ƒç¯å¢ƒæ˜¯çº¢è‰²ï¼Œç”Ÿäº§ç¯å¢ƒåˆ™è¿›è¡Œéšè—ã€‚ç‚¹å‡»è§’æ ‡åˆ™å¯ä»¥è¿›å…¥å¼€å‘å’Œæµ‹è¯•äººå‘˜ä¸“ç”¨çš„ Helper é¡µé¢ã€‚

![l2NhBIcbRMFgjus.png](https://cdn.sa.net/2024/03/15/l2NhBIcbRMFgjus.png)

![aeVQTZ4cdoEzi9F.png](https://cdn.sa.net/2024/03/15/aeVQTZ4cdoEzi9F.png)

## â­ï¸ å®ç°å°ç¨‹åºä¸­çš„è·¯ç”±ç³»ç»Ÿ

å°ç¨‹åºçš„è·¯ç”±é«˜åº¦ä¾èµ–æ–‡ä»¶å¤¹ç»“æ„ï¼Œæ¯å½“é¡¹ç›®æ–‡ä»¶æ›´æ¢è·¯å¾„ï¼Œå°±éœ€è¦å…¨å±€æŸ¥æ‰¾å¹¶æ›¿æ¢é¡µé¢è·¯å¾„ï¼›å¹¶ä¸” `wx.navigateTo` ç­‰ API æœ¬èº«åªèƒ½æ¥å—å­—ç¬¦ä¸²å½¢å¼çš„è·¯ç”±å‚æ•°ï¼Œå› æ­¤å¸¸å¸¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æ‹¼æ¥è·¯ç”±å‚æ•°ã€‚ä¸ºäº†è§£å†³è¿™äº›ç—›ç‚¹ï¼Œæˆ‘ä» Vue Router ä¸­å¾—åˆ°çµæ„Ÿï¼Œå°è£…äº†ä¸€å¥—ç®€æ˜“çš„è·¯ç”±ç³»ç»Ÿã€‚

æ€è·¯ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯ç»™æ‰€æœ‰çš„é¡µé¢å–ä¸ªåå­—ï¼Œæ”¾è¿›ä¸€ä¸ªè·¯ç”±å¯¹è±¡ä¸­ï¼Œæ ¼å¼ä¸º `{ routeName: 'routePath' }`ã€‚è¿›è¡Œè·¯ç”±è·³è½¬æ—¶ï¼Œåªéœ€è¦è°ƒç”¨ `Routes[routeName]` å³å¯è·å–çœŸå®è·¯å¾„ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥éšæ„ç»„ç»‡å°ç¨‹åºæ–‡ä»¶å¤¹ç»“æ„ï¼Œè€Œä¸ä¼šå½±å“é€»è¾‘ä»£ç äº†ã€‚

è‡³äºæ‹¼æ¥å‚æ•°çš„é—®é¢˜ï¼Œæˆ‘ä»¬åˆ™å¯ä»¥ç¼–å†™ä¸€ä¸ªç®€å•çš„å‡½æ•°ï¼Œæ¥å—å¯¹è±¡ç±»å‹çš„å‚æ•°ï¼Œå¹¶ç»„è£…æˆå­—ç¬¦ä¸²å³å¯ã€‚è€Œå°ç¨‹åºæä¾›çš„å¤šä¸ªè·¯ç”±å‡½æ•°ï¼Œæˆ‘ä»¬ä¹Ÿåªéœ€è¦ä½¿ç”¨ä¸€ä¸ªé«˜é˜¶å‡½æ•°å³å¯ç”Ÿæˆï¼Œä¸éœ€è¦æ¯ä¸ªéƒ½å•ç‹¬å°è£…ä¸€éã€‚

<details>
<summary>`router/routes.js`</summary>

```javascript
export const Routes = {
  Index: '/pages/index/index',
  Activities: '/pages/tabs/activities/activities',
  Mine: '/pages/tabs/mine/mine',
  Portal: '/pages/portal/portal',
  Login: '/pages/login/login',
  Helper: '/pages/helper/helper',
  Address: '/pages/profiles/address/address',
  Setting: '/pages/profiles/setting/setting',
  // å°¤å…¶é€‚ç”¨äºè¿™ç§å¾ˆé•¿çš„è·¯å¾„ï¼
  ArticleDetail: '/subpackages/rickTextRender/pages/articleDetail/articleDetail',
};
```

</details>

<details>
<summary>`router/router.js`</summary>

```javascript
import { Routes } from './routes';

export const getRouteUrl = (routeName) => {
  const targetRoute = Routes[routeName];
  if (!targetRoute) {
    console.error(`The RouteName must be one of: ${Object.keys(Routes).join(', ')}`);
    return;
  }

  return targetRoute;
};

export const buildParams = (params) => {
  let fullParamStr;
  if (!params) {
    fullParamStr = '';
  } else if (typeof params === 'string') {
    fullParamStr = params;
  } else {
    fullParamStr = Object.keys(params)
      .map((key, index) => {
        const prefix = index === 0 ? `?` : `&`;
        return `${prefix}${key}=${params[key]}`;
      })
      .join('');
  }

  return fullParamStr;
};

/**
 * é«˜é˜¶å‡½æ•°æ„å»ºè·¯ç”±è·³è½¬æ¨¡å—
 * @param {Function} method
 */
const generateRoute = (method) => (routeName, params, events) =>
  method({
    url: getRouteUrl(routeName) + buildParams(params),
    events: events ?? null,
  });

export const switchTab = generateRoute(wx.switchTab);
export const reLaunch = generateRoute(wx.reLaunch);
export const navigateTo = generateRoute(wx.navigateTo);
export const redirectTo = generateRoute(wx.redirectTo);
```

</details>

<details>
<summary>Example</summary>

```javascript
// æ‰‹åŠ¨æ·»åŠ å­—ç¬¦ä¸²å‚æ•°
navigateTo('ActivityDetail', `?goodsId=${goodsId}`);

// å¯¹è±¡å½¢å¼ä¼ å‚
navigateTo('CommentDetail', {
  client: this.commentClient,
  topicId: this.data.reportId,
  commentId,
});

// æ”¯æŒ EventChannel
navigateTo('Address', { pageFrom: 'POINT_MALL_SUBMIT' }, { addressSubmitted: this.initAddressForm.bind(this) });
```

</details>

## æŒ‰ç…§å°±è¿‘åŸåˆ™ç»„ç»‡é¡¹ç›®

åœ¨é¡¹ç›®åˆæœŸï¼Œæˆ‘æ˜¯å‡ ä¹å¯¹ç…§ Vue CLI é¡¹ç›®ç»„ç»‡ä»£ç ï¼Œæ¯”å¦‚æŠŠç»„ä»¶éƒ½æ”¾åœ¨ components æ–‡ä»¶å¤¹ä¸‹ï¼ŒæŠŠå›¾ç‰‡å’Œå›¾æ ‡æ”¾åœ¨ assets æ–‡ä»¶å¤¹ä¸‹ï¼Œä½†éšç€é¡¹ç›®ä¸­çš„ç»„ä»¶å’Œæ–‡ä»¶è¶Šæ¥è¶Šå¤šï¼Œcomponents å’Œ assets ç›®å½•ä¸‹å‡ºç°äº†å¤§é‡åªç”¨åˆ°ä¸€æ¬¡çš„ç»„ä»¶å’Œå›¾ç‰‡ã€‚

ç”±äºå°ç¨‹åºä¸¥æ ¼é™åˆ¶æ¯ä¸ªåŒ…æœ€å¤§åªæœ‰ 2Mï¼Œæˆ‘ä»¬éœ€è¦æ›´åŠ æ³¨é‡é¡¹ç›®ä½“ç§¯ã€‚å› æ­¤ï¼Œä¸ºäº†åº”ä»˜è¶Šå‘å¤æ‚çš„éœ€æ±‚ï¼Œæˆ‘å¯¹é¡¹ç›®ä»£ç è¿›è¡Œäº†é‡æ–°æ•´ç†ï¼Œä¸»è¦æ˜¯æ ¹æ®æ˜¯å¦å¤ç”¨æŠŠç»„ä»¶å’Œé™æ€èµ„æºè¿›è¡Œäº†æ‹†åˆ†ï¼Œåªåœ¨é¡µé¢ä¸­ä½¿ç”¨ä¸€æ¬¡çš„ç»„ä»¶æˆ–èµ„æºæ”¾ç½®åœ¨é¡µé¢åŒçº§ä¸‹ï¼Œè€ŒçœŸæ­£è¢«å¤šæ¬¡å¤ç”¨çš„ç»„ä»¶å’Œèµ„æºæ‰æ”¾ç½®åœ¨ compoents å’Œ assets ä¸­ã€‚

å¦‚æ­¤ä¸€æ¥ï¼Œå½“æŸä¸ªé¡µé¢åºŸå¼ƒæ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦ç§»é™¤è¿™ä¸ªé¡µé¢æ–‡ä»¶å¤¹ï¼Œå½“å‰é¡µé¢ç‹¬äº«çš„ç»„ä»¶å’Œèµ„æºå°†è¢«ä¸€èµ·ç§»é™¤ï¼Œä¸ç”¨å†æ»¡é¡¹ç›®æŸ¥æ‰¾ã€‚

<details>
<summary>Example</summary>

```text
// âŒ ç»å…¸ç»„åˆæ¨¡å¼ã€‚éšç€é¡¹ç›®è¶Šæ¥è¶Šå¤§ï¼Œæ›´å®¹æ˜“äº§ç”Ÿä¸è¢«å¼•ç”¨åˆä¸æ•¢åˆ é™¤çš„èµ„æº
â”œâ”€â”€ assets
â”‚Â Â  â”œâ”€â”€ activities-logo.png
â”‚Â Â  â”œâ”€â”€ common.png
â”‚Â Â  â””â”€â”€ report-logo.png
â”œâ”€â”€ components
â”‚Â Â  â”œâ”€â”€ activity-card
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ index.js
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ index.json
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ index.wxml
â”‚Â Â  â”‚Â Â  â””â”€â”€ index.wxss
â”‚Â Â  â””â”€â”€ report-card
â”‚Â Â      â”œâ”€â”€ index.js
â”‚Â Â      â”œâ”€â”€ index.json
â”‚Â Â      â”œâ”€â”€ index.wxml
â”‚Â Â      â””â”€â”€ index.wxss
â””â”€â”€ pages
    â”œâ”€â”€ activities
    â”‚Â Â  â”œâ”€â”€ activities.js
    â”‚Â Â  â”œâ”€â”€ activities.json
    â”‚Â Â  â”œâ”€â”€ activities.wxml
    â”‚Â Â  â””â”€â”€ activities.wxss
    â””â”€â”€ reports
        â”œâ”€â”€ reports.js
        â”œâ”€â”€ reports.json
        â”œâ”€â”€ reports.wxml
        â””â”€â”€ reports.wxss

// âœ… æ–°ç‰ˆç›®å½•ç»“æ„
â”œâ”€â”€ assets
â”‚Â Â  â””â”€â”€ common.png
â”œâ”€â”€ components
â””â”€â”€ pages
    â”œâ”€â”€ activities
    â”‚Â Â  â”œâ”€â”€ activities.js
    â”‚Â Â  â”œâ”€â”€ activities.json
    â”‚Â Â  â”œâ”€â”€ activities.wxml
    â”‚Â Â  â”œâ”€â”€ activities.wxss
    â”‚Â Â  â”œâ”€â”€ activity-card
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ index.js
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ index.json
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ index.wxml
    â”‚Â Â  â”‚Â Â  â””â”€â”€ index.wxss
    â”‚Â Â  â””â”€â”€ logo.png
    â””â”€â”€ reports
        â”œâ”€â”€ logo.png
        â”œâ”€â”€ report-card
        â”‚Â Â  â”œâ”€â”€ index.js
        â”‚Â Â  â”œâ”€â”€ index.json
        â”‚Â Â  â”œâ”€â”€ index.wxml
        â”‚Â Â  â””â”€â”€ index.wxss
        â”œâ”€â”€ reports.js
        â”œâ”€â”€ reports.json
        â”œâ”€â”€ reports.wxml
        â””â”€â”€ reports.wxss
```

</details>

## æƒé™æ¨¡å—

æˆ‘æŠŠå°ç¨‹åºé¡¹ç›®ä¸­æ‰€æœ‰æˆæƒå’Œæƒé™ç›¸å…³é€»è¾‘å…¨éƒ¨æ”¾ç½®åœ¨ `utils/Auth.js` ä¸­ã€‚

### å¾®ä¿¡æˆæƒç»Ÿä¸€ç®¡ç†

åœ¨å°ç¨‹åºå¼€å‘è¿‡ç¨‹ä¸­ï¼Œä¸€å®šä¼šå’Œå¾®ä¿¡æˆæƒæ‰“äº¤é“ã€‚ç”¨æˆ·æˆæƒæ˜¯ä¸€ä¸ªå¾ˆéº»çƒ¦çš„äº‹æƒ…ï¼Œæ¯•ç«Ÿåœ¨æ•´ä¸ªå°ç¨‹åºå‘¨æœŸä¸­ï¼Œæœ‰äº›æƒé™åªè¦ç”¨æˆ·æ‹’ç»è¿‡ä¸€æ¬¡å°±æ— æ³•å†æ¬¡å‘èµ·ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦åœ¨ç”¨æˆ·æ‹’ç»æˆæƒåå°½é‡ç»™å‡ºæç¤ºï¼Œå°è¯•å¼•å¯¼ç”¨æˆ·ä¸»åŠ¨æ‰“å¼€æˆæƒã€‚

<details>
<summary>`utils/Auth.js`</summary>

```javascript
/**
 * åˆ¤æ–­å¾®ä¿¡çš„æŸä¸ªæƒé™æ˜¯å¦æˆæƒé€šè¿‡ï¼Œä¼šè‡ªåŠ¨è°ƒèµ·æˆæƒå¼¹çª—ä»¥åŠæ˜¾ç¤ºæ‹’ç»å¼•å¯¼
 * @param {String} scope <https://developers.weixin.qq.com/miniprogram/dev/api/open-api/setting/AuthSetting.html>
 * @param {Boolean} withRejectGuide æ˜¯å¦æ˜¾ç¤ºæ‹’ç»åçš„å†æ¬¡æˆæƒå¼•å¯¼
 * @returns {Boolean} æ˜¯å¦æˆæƒé€šè¿‡
 */
static async isWxAuthed(scope, withRejectGuide = true) {
  const { authSetting } = await wxp.getSetting();
  let authResult;
  // ä»æœªæˆæƒ
  if (!Object.keys(authSetting).includes(scope)) {
    // å¯¹äº scope.userInfoï¼Œå¦‚æœè¿˜æ²¡æœ‰æˆæƒï¼Œåˆ™ç›´æ¥è¿”å›æˆæƒå¤±è´¥ã€‚
    if (scope === 'scope.userInfo') {
      authResult = true;
    } else {
      try {
        await wxp.authorize({ scope });
        authResult = true;
      } catch {
        authResult = false;
      }
    }
  }
  // æˆæƒé€šè¿‡
  else if (authSetting[scope]) {
    authResult = true;
  }
  // æˆæƒæ‹’ç»
  else {
    authResult = false;
  }

  if (scope !== 'scope.userInfo' && !authResult && withRejectGuide) {
    await wxp.showModal({
      title: 'æ— æ­¤æƒé™',
      content: 'è¯·ç‚¹å‡»å³ä¸Šè§’çš„èœå•ï¼Œç‚¹å‡»è®¾ç½®æŒ‰é’®ï¼Œå³å¯é‡æ–°å¼€å¯æ­¤æƒé™'
    });
  }

  return authResult;
}
```

</details>

<details>
<summary>Example</summary>

```javascript
async onSaveQrcode() {
  const isAuthed = await Auth.isWxAuthed('scope.writePhotosAlbum');
  if (isAuthed) {
    try {
      await wx.saveImageToPhotosAlbum({ filePath: '/pages/static/pickGroup/qrcode.jpg' });
      wx.showToast({ title: 'ä¿å­˜æˆåŠŸ' });
    } catch (e) {
      wx.showToast({ title: 'ä¿å­˜å¤±è´¥', icon: 'none' });
    }
  }
}
```

</details>

### â­ï¸â­ï¸ ç”¨æˆ·ç™»å½•æ‹¦æˆª

éšç€å°ç¨‹åºé¡¹ç›®è¶Šæ¥è¶Šå¤§ï¼Œæˆ‘ä»¬ä¸å¾—ä¸è€ƒè™‘ç”¨æˆ·ç™»å½•æ“ä½œçš„å„ç§æ—¶æœºã€‚é¡¹ç›®æ—©æœŸï¼Œç”¨æˆ·ç™»å½•æ“ä½œåˆ†å¸ƒåœ¨å„ç§åœ°æ–¹ï¼Œæ¯”å¦‚æ´»åŠ¨é¡µçš„æŸä¸ªæŒ‰é’®å¯èƒ½ä¼šè§¦å‘ç™»å½•ã€â€œæˆ‘çš„â€ é¡µé¢çš„å¤´åƒä¹Ÿä¼šè§¦å‘ç™»å½•ï¼Œè€Œç‚¹å‡»ä»»æ„ä¸€ä¸ªèœå•ä¹Ÿæœ‰å¯èƒ½è§¦å‘ç™»å½•ã€‚è¿™ç§åˆ†æ•£çš„æ“ä½œç»™é¡¹ç›®ç»´æŠ¤å¸¦æ¥äº†å¾ˆå¤§çš„è´Ÿæ‹…ã€‚

åç»­æˆ‘ä»¬å†³å®šå°†ç”¨æˆ·çš„ç™»å½•æ“ä½œæ”¶æ•›åˆ°ä¸€ä¸ªç»Ÿä¸€çš„ç™»å½•é¡µé¢ï¼Œåªè¦éœ€è¦ç”¨æˆ·è¿›è¡Œç™»å½•ï¼Œå°±å…¨éƒ¨é‡å®šå‘åˆ°ç™»å½•é¡µè¿›è¡Œç™»å½•ã€‚å¹¶ä¸”ç”±äºæˆ‘ä»¬ä¼šåœ¨ç”¨æˆ·ç™»å½•åè®°å½•ç”¨æˆ·çš„ openidï¼Œå› æ­¤ç”¨æˆ·é‡æ–°è¿›å…¥å°ç¨‹åºåï¼ˆåŒ…æ‹¬åˆ é™¤å°ç¨‹åºå†è¿›å»ï¼‰ä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡ openid è·å–ç”¨æˆ·ä¿¡æ¯å®ç°å°ç¨‹åºç«¯çš„ç™»å½•ã€‚**ä¹Ÿå°±æ˜¯è¯´ï¼Œç”¨æˆ·åœ¨æ•´ä¸ªä½¿ç”¨å°ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œåªéœ€è¦ç™»å½•ä¸€æ¬¡ï¼Œæ‰€ä»¥æ­¤å¤„çš„ç™»å½•å…¶å®æ›´åƒæ˜¯â€œæ³¨å†Œâ€æ“ä½œã€‚**

> ğŸ’¡ ä» 2021 å¹´ 2 æœˆ 23 æ—¥èµ·ï¼Œå°ç¨‹åºå¯ä»¥é€šè¿‡ wx.login æ¥å£ç›´æ¥è·å–ç”¨æˆ·çš„ unionIdï¼Œå› æ­¤åœ¨æ•°æ®åº“ä¸­åº”å½“ä½¿ç”¨ unionId ä½œä¸ºç”¨æˆ·å”¯ä¸€æ ‡è¯†è€Œé openidã€‚

å…·ä½“å®ç°æ€è·¯ï¼š

1. åœ¨ app.js ä¸­åˆå§‹åŒ–ç”¨æˆ·ç™»å½•çŠ¶æ€å’Œç”¨æˆ·ä¿¡æ¯ï¼Œå¹¶å°†è¿™äº›ä¿¡æ¯ä¿å­˜åˆ° localStorage ä¸­ã€‚æ¯”å¦‚æœªç™»å½•å°±ä¿å­˜ `is_logged` å€¼ä¸º false
2. **å°è£…** **`requireLogged`** **æ–¹æ³•ï¼Œä¼ å…¥ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå¦‚æœç”¨æˆ·å·²ç™»å½•åˆ™ç›´æ¥æ‰§è¡Œå›è°ƒï¼Œæ²¡æœ‰åˆ™è·³è½¬åˆ°ç™»å½•é¡µã€‚**ä¹Ÿå°±æ˜¯ç”¨ `requireLogged` æ–¹æ³•åŒ…è£¹ç™»å½•åæ‰§è¡Œçš„é€»è¾‘ã€‚è¿™ä¸ªæ–¹æ³•éœ€è¦ç»“åˆ `wx.navigateTo` å’Œ [EventChannel](https://developers.weixin.qq.com/miniprogram/dev/api/route/EventChannel.html) å…±åŒå®ç°ï¼Œæ³¨æ„ navigateTo çš„ç¬¬ä¸‰ä¸ªå‚æ•°å³æ˜¯ç›‘å¬ç™»å½•å®Œæ¯•äº‹ä»¶

   > ğŸ’¡ è¿™ç§æ–¹æ¡ˆæœ‰ä¸€ä¸ªä¼˜ç‚¹æ˜¯å¯¹äºå¼€å‘äººå‘˜æ¥è¯´å‡ ä¹æ— æ„Ÿï¼Œåªéœ€è¦æŠŠåŸæ¥çš„é€»è¾‘ç”¨å‡½æ•°åŒ…è£¹ä¸€ä¸‹å¤åˆ¶åˆ° requireLogged ä¸­é—´å³å¯ã€‚

<details>
<summary>`utils/Auth.js`</summary>

```javascript
/**
 * è¦æ±‚ç”¨æˆ·æ³¨å†Œåæ‰§è¡Œã€‚ç»“åˆ eventChannel å®ç°æ³¨å†Œåç«‹å³æ‰§è¡Œ
 * @param {Function} cb éœ€è¦æ³¨å†Œåæ‰§è¡Œçš„å›è°ƒå‡½æ•°
 * @param {boolean} immediateDoCb æ³¨å†Œåæ˜¯å¦ç«‹å³æ‰§è¡Œå›è°ƒå‡½æ•°
 * @param {boolean} forceDoLogin æ— è§†æ˜¯å¦å·²æ³¨å†Œï¼Œå¼ºåˆ¶è¿›å…¥æ³¨å†Œé¡µé¢
 */
static requireLogged(cb, immediateDoCb = false, forceDoLogin = false) {
  if (Auth.isLogged() && !forceDoLogin) {
    cb && cb();
  } else {
    navigateTo('Login', null, {
      logged: () => {
        immediateDoCb && cb && cb();
      }
    });
  }
}
```

</details>

3. åœ¨ Login é¡µé¢å®ç°ç™»å½•é€»è¾‘ï¼Œå½“ç™»å½•æˆåŠŸåï¼š1. è¯·æ±‚åå°æ¥å£ï¼Œä¿å­˜ç”¨æˆ·ä¿¡æ¯ 2. é‡æ–°æ‰§è¡Œ app.js ä¸­çš„ç”¨æˆ·ä¿¡æ¯åˆå§‹åŒ–æ–¹æ³• 3. æ‰§è¡Œ `await wx.navigateBack()` è¿”å›ä¸Šä¸€çº§é¡µé¢ã€‚**æ³¨æ„ï¼šæ­¤å¤„çš„ await ä¸èƒ½çœç•¥ï¼è¿™æ˜¯ç”±äºå‡å¦‚ callback é‡Œé¢çš„æ“ä½œæ˜¯ä¸€ä¸ªé¡µé¢è·³è½¬ï¼Œé‚£ä¹ˆå¦‚æœä¸æ·»åŠ  await ç­‰å¾…è¿”å›æ“ä½œæ‰§è¡Œå®Œæ¯•ï¼Œå¯èƒ½ä¼šå¼•èµ·é¡µé¢æ ˆæ··ä¹±è€ŒæŠ¥é”™**
   <details>
<summary>`login.js`</summary>

```javascript
// ç‚¹å‡»ç™»å½•é¡µçš„ç™»å½•æŒ‰é’®è§¦å‘
async onLogin() {
  const eventChannel = this.getOpenerEventChannel();
  const res = await Auth.getUserProfileCtx();
	// Auth.updateUserProfile ä¸»è¦ç”¨æ¥è¯·æ±‚åç«¯çš„æ›´æ–°ç”¨æˆ·ä¿¡æ¯æ¥å£
  await Auth.updateUserProfile({
    userInfo: res.userInfo,
    loadingMsg: 'ç™»å½•ä¸­...',
    retryMsgContent: 'ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•',
  });
  app.initUserInfo();

  wx.showToast({ title: 'ç™»å½•æˆåŠŸ', duration: 500 });
  await asyncTimeout(500);

  // æ³¨æ„ï¼Œæ­¤å¤„ await ä¸èƒ½å»æ‰ï¼Œå¦åˆ™å¯èƒ½ä¼šå¯¼è‡´å›è°ƒäº‹ä»¶å› ä¸ºé¡µé¢æ ˆé”™ä¹±è€Œå¼‚å¸¸
  await wx.navigateBack();

  // ç™»å½•åé‡æ–°æäº¤å·²ç™»å½•äº‹ä»¶
  eventChannel.emit('logged');
},
```

</details>

<details>
<summary>Example</summary>

```javascript
// ä¸€ä¸ªç”¨æˆ·ç‚¹èµæ“ä½œã€‚æœªç™»å½•æ—¶ä¼šè‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µï¼Œå·²ç™»å½•åˆ™ç›´æ¥è§¦å‘ç‚¹èµ
Auth.requireLogged(
  () => {
    this.triggerEvent('click-like');
  },
  // å®Œæˆç™»å½•åç›´æ¥å†æ¬¡è§¦å‘ç‚¹èµæ“ä½œ
  true,
);
```

</details>

## å®šä¹‰æ¨¡å‹ç±»ä¿è¯æ•°æ®ç»“æ„ç¨³å®š

å°ç¨‹åºç»å†äº†ä¸€ç³»åˆ—è¿­ä»£åï¼Œæœ‰äº›æ•°æ®æ˜¯éœ€è¦æ•´ä¸ªé¡¹ç›®åˆ°å¤„ä½¿ç”¨çš„ï¼Œæ¯”å¦‚ç”¨æˆ·ä¿¡æ¯ã€ç³»ç»Ÿä¿¡æ¯ã€å¯¼èˆªæ ä¿¡æ¯ã€è¯„è®ºå‚æ•°å¯¹è±¡ç­‰ã€‚ä¸ºäº†ä¿è¯è¿™äº›â€œåˆ°å¤„ä¹±é£â€çš„æ•°æ®çš„ç¨³å®šï¼Œæˆ‘ä» TypeScript ä¸­çš„ `interface` æ±²å–çµæ„Ÿï¼Œå®šä¹‰äº†ä¸€äº›ç±»ä¼¼åç«¯å¼€å‘ä¸­å¸¸è§çš„ `Model`ï¼Œå½“éœ€è¦ä½¿ç”¨å›ºå®šçš„æ•°æ®ç»“æ„æ—¶ï¼Œå¿…é¡»ä½¿ç”¨ `new` å…³é”®å­—è¿›è¡Œå®ä¾‹åŒ–ã€‚è¿™æ ·æœ‰å‡ ä¸ªå¥½å¤„ï¼š

- å¯ä»¥æŠŠå¤æ‚çš„å¤§é‡å‚æ•°è¿›è¡Œå°è£…ï¼Œè·¨ç»„ä»¶é€šä¿¡æ—¶åªä¼ é€’å®ä¾‹åŒ–å‡ºæ¥çš„å¯¹è±¡
- å½“éœ€è¦æŸ¥çœ‹æŸä¸ªæ•°æ®ç»“æ„æ—¶ï¼Œåªéœ€è¦æŸ¥çœ‹å¯¹åº”çš„ç±»ç»“æ„å³å¯
- åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ç­‰ IDE ä¸­ï¼Œå¯ä»¥å®ç°ä¸€å®šçš„ä»£ç è¡¥å…¨æ•ˆæœ
  <details>
<summary>Exampleï¼šè¯„è®ºç³»ç»Ÿä¸­çš„ `CommentPayload`</summary>

```javascript
// config/interfaces.js
export class CommentPayload {
  constructor({
    // same with COMMENT_SYSTEM_CLIENT_ID
    client,
    // è¯é¢˜ id
    topicId = 0,
    // ç¼–è¾‘æ¡†å†…å®¹
    content = '',
    // çˆ¶è¯„è®º id
    parentId = 0,
    // éœ€è¦å›å¤çš„ id
    toReplyId = 0,
    // ç¼–è¾‘æ¡†æç¤ºè¯­
    placeholder = 'å†™è¯„è®º...',
    // ç¼–è¾‘æ¡†ä¸Šæ–¹æ˜¾ç¤ºçš„å¤´åƒã€‚éœ€è¦åŒæ—¶ä¼ é€’ carryingContent åæ‰èƒ½æ˜¾ç¤º
    carryingAvatar = '',
    // ç¼–è¾‘æ¡†ä¸Šæ–¹æ˜¾ç¤ºçš„æç¤ºå†…å®¹
    carryingContent = '',
    // ç¼–è¾‘æ¡†æœ€é•¿å­—æ•°
    editorMaxLength = 140,
    // ç¼–è¾‘æ¡†æœ€å°å­—æ•°
    editorMinLength = 0,
  }) {
    this.client = client;
    this.topicId = topicId;
    this.content = content;
    this.parentId = parentId;
    this.toReplyId = toReplyId;
    this.placeholder = placeholder;
    this.carryingAvatar = carryingAvatar;
    this.carryingContent = carryingContent;
    this.editorMaxLength = editorMaxLength;
    this.editorMinLength = editorMinLength;
    if (this.client && Commenter.checkClient(client)) {
      this.clientId = Commenter.getClientId(client);
    }
  }
}
```

</details>

## â­ï¸â­ï¸ å¼•å…¥ Gulp å·¥ä½œæµ

åœ¨å°ç¨‹åºå¼€å‘è¿‡ç¨‹ä¸­ï¼Œæ ·å¼ç¼–å†™å¤§æ¦‚æ˜¯æ°¸è¿œçš„ç—›ç‚¹ä¹‹ä¸€ã€‚åœ¨é¢å¯¹è¶Šå‘å¤æ‚çš„æ ·å¼éœ€æ±‚æ—¶ï¼Œå°ç¨‹åºçš„ wxss å¾ˆéš¾æ»¡è¶³æˆ‘çš„è¦æ±‚ã€‚å› æ­¤æˆ‘å°è¯•åœ¨å°ç¨‹åºä¸­ä½¿ç”¨ Scss è¯­æ³•ç¼–å†™æ ·å¼ï¼Œåœ¨ä¸€ç³»åˆ—å¯¹æ¯”åï¼Œæˆ‘è¿˜æ˜¯é€‰æ‹©äº†æµç•…ç®€å•çš„ Gulpã€‚å½“ç„¶ï¼Œæ—¢ç„¶å¼•å…¥äº† Gulpï¼Œæˆ‘ä»¬å°±å¯ä»¥åšæ›´å¤šèŠ±å“¨çš„æ“ä½œäº†ï¼Œæ¯”å¦‚ï¼Œç”Ÿäº§ç¯å¢ƒä¸‹å¯¹ js å’Œ wxss è¿›è¡Œä»£ç å‹ç¼©ã€æŠŠéƒ¨åˆ†é«˜é˜¶ ES è¯­æ³•è½¬è¯‘ä¸ºä½é˜¶è¯­æ³•ã€ä½¿ç”¨ yaml ä»£æ›¿ json ç¼–å†™é…ç½®ç­‰ã€‚

æˆ‘ä»¬çš„å°ç¨‹åºä¸­æ²¡æœ‰ä½¿ç”¨å¤ªå¤æ‚çš„ Gulp é…ç½®ï¼Œåªæ˜¯ç€é‡æ”¯æŒäº† Scss ä»£ç ç¼–å†™ã€æ ·å¼å’Œ JS ä»£ç å‹ç¼©ä¸¤ä¸ªåŠŸèƒ½ï¼Œè€Œæ„å»ºåçš„äº§ç‰©åˆ™è¾“å‡ºåˆ° dist ç›®å½•ä¸‹ã€‚å¼•å…¥ Gulp åï¼Œå°ç¨‹åºçš„æ”¹åŠ¨å¹¶ä¸å¤§ï¼Œä¸»è¦æ˜¯ï¼š

- åœ¨ project.config.json ä¸­æŠŠå°ç¨‹åºçš„æ ¹ç›®å½•æ”¹ä¸º distï¼š`"miniprogramRoot": "dist/",`
- ç”±äº Scss æ˜¯ CSS çš„è¶…é›†ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®‰å…¨çš„ç›´æ¥å¯¹è€çš„æ ·å¼æ–‡ä»¶è¿›è¡Œé‡å‘½åï¼Œæ‰€ä»¥ç›´æ¥è·‘ä¸€ä¸ªè„šæœ¬æŠŠé¡¹ç›®ä¸­çš„ .wxss æ‰¹é‡é‡å‘½åä¸º .scss å°±å®Œäº‹äº†
- æŠŠå¤–éƒ¨æ ·å¼è¡¨ï¼Œå¦‚ vant ä¸­çš„ `common/index.wxss` é‡å‘½åä¸º `common/index.scss`

æœ€ç»ˆçš„ç¤ºä¾‹ä»£ç ï¼š

<details>
<summary>`gulpfile.js`</summary>

```javascript
const path = require('path');
const del = require('del');
const gulp = require('gulp');
// Windows å¹³å°ä¸‹ gulp.watch ä¸ç”Ÿæ•ˆï¼Œéœ€è¦ç”¨æ­¤æ’ä»¶æ›¿ä»£ã€‚å¹¶ä¸”æ­¤æ’ä»¶æ€§èƒ½æ›´ä½³
const gulpWatch = require('gulp-watch');
const sass = require('gulp-dart-sass');
const rename = require('gulp-rename');
const terser = require('gulp-terser');
const uglifycss = require('gulp-uglifycss');
const gulpIf = require('gulp-if');

const isProd = process.env.NODE_ENV === 'production';
const SRC = path.resolve(__dirname, './src');
const DIST = path.resolve(__dirname, './dist');
const PANTONE = path.resolve(__dirname, './pantone');

const _clean = () => del(DIST);
const _copy = (ext) => gulp.src(`${SRC}/**/*.${ext}`).pipe(gulp.dest(DIST));
const staticExts = ['png', 'jpg'];
const _static = gulp.parallel(staticExts.map((ext) => () => _copy(ext)));
const _wxml = () => _copy('wxml');
const _wxs = () => _copy('wxs');
const _json = () => _copy('json');
const _wxss = () => _copy('wxss');
const _sass = () =>
  gulp
    .src(`${SRC}/**/*.scss`)
    .pipe(sass())
    .pipe(gulpIf(isProd, uglifycss()))
    .pipe(rename({ extname: '.wxss' }))
    .pipe(gulp.dest(DIST));
const _js = () => gulp.src(`${SRC}/**/*.js`).pipe(gulpIf(isProd, terser())).pipe(gulp.dest(DIST));
const _pantone = () =>
  gulp
    .src(`${PANTONE}/pantone.scss`)
    .pipe(sass())
    .pipe(rename('variables.css'))
    .pipe(gulp.dest(`${PANTONE}/assets`));

const build = gulp.series(_clean, gulp.parallel(_wxml, _wxs, _json, _wxss, _static, _sass, _js));
const watch = gulp.series(build, () => {
  gulpWatch(`${SRC}/**/*.wxml`, _wxml);
  gulpWatch(`${SRC}/**/*.wxss`, _wxss);
  gulpWatch(`${SRC}/**/*.wxs`, _wxs);
  gulpWatch(`${SRC}/**/*.json`, _json);
  gulpWatch(`${SRC}/**/*.{${staticExts.join(',')}}`, _static);
  gulpWatch(`${SRC}/**/*.js`, _js);
  gulpWatch(`${SRC}/**/*.scss`, _sass);
});
const pantone = gulp.series(_pantone);

module.exports = { build, watch, pantone };
```

</details>

<details>
<summary>`package.json`</summary>

```javascript
"scripts": {
  "dev": "NODE_ENV=development npx gulp watch",
  "build": "NODE_ENV=production npx gulp build"
},
```

</details>

<details>
<summary>Exampleï¼šé¡¹ç›®ä¸­çš„ Scss ä»£ç ï¼ˆå·²åºŸå¼ƒä½¿ç”¨ Scss å˜é‡ï¼Œè§ä¸‹ä¸€å°èŠ‚ï¼‰</summary>

```scss
// styles/_variables.scss
$color-primary: #fbd45f;
$color-white: #fff;
$color-black: #222;
$color-black-lighter: #333;
$color-gray: #888;
$color-gray-heavier: #666;
$color-gray-lighter: #aaa;
$color-yellow: #f7dc00;
$color-blue: #5a94e3;
$color-red: #ee0a24;

// styles/_mixins.scss
@mixin set-ellipsis($line: 1, $break-type: break-all) {
  word-break: $break-type;
  text-overflow: ellipsis;
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-line-clamp: $line;
  overflow: hidden;
}

@mixin reset-button() {
  width: 100%;
  height: 88rpx;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 44rpx;
  font-weight: normal;
  padding-left: 0;
  padding-right: 0;
  line-height: 1;

  &:after {
    border: 0;
  }
}

// page.scss
.report_card {
  padding-top: 40rpx;
  padding-bottom: 40rpx;
  border-bottom: 1px solid #eaebf0;

  .order {
    font-size: 24rpx;
  }

  .goods {
    margin-top: 12rpx;
    display: flex;

    &-cover {
      flex-shrink: 0;
      width: 158rpx;
      height: 158rpx;
      background: #d7dae3;
      border-radius: 20rpx;
    }
  }
}
```

</details>

## â­ï¸ ä½¿ç”¨ CSS å˜é‡

ä¸ºäº†è®©é¡¹ç›®ä¸­çš„å„ç§é¢œè‰²ã€å­—å·æ›´åŠ ç»Ÿä¸€ï¼Œæˆ‘ä»¬æœ‰å¿…è¦æå‰å®šä¹‰å¥½ä¸€äº›å¯ç”¨çš„è‰²å€¼å­—å·ã€‚ç›®å‰æ¯”èµ· Scss å˜é‡ï¼Œæˆ‘æ›´æ¨èåœ¨é¡¹ç›®ä¸­ä½¿ç”¨åŸç”Ÿçš„ CSS å˜é‡ï¼Œè€Œå¾®ä¿¡å°ç¨‹åºä¹Ÿæ˜¯æ”¯æŒä½¿ç”¨ CSS å˜é‡çš„ã€‚

<details>
<summary>Example</summary>

```scss
// styles/_reset.scss
page {
  // å®šä¹‰ CSS å˜é‡
  --color-primary: #fbd45f;
  --size-base: 28rpx;

  // ...
}

view {
  box-sizing: border-box;
}
```

</details>

ç„¶è€Œï¼Œå½“é¡¹ç›®ä¸­ä½¿ç”¨çš„ CSS å˜é‡è¾ƒå¤šæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ä½¿ç”¨ Scss è‡ªåŠ¨ç”Ÿæˆ CSS å˜é‡ã€‚ä¸‹é¢çš„ä»£ç å¤§å¹…å‚è€ƒäº† [Bootstrap](https://getbootstrap.com/)ã€‚å¦å¤–ï¼Œå¦‚æœä½ æƒ³æ›´æ·±å…¥çš„äº†è§£ Scssï¼Œæˆ‘ä¹Ÿå¼ºçƒˆå»ºè®®ä½ é˜…è¯» Bootstrap çš„æºç ï¼ŒçœŸçš„æ˜¯é›†ä¼˜é›…ä¸èŠ±å“¨äºä¸€èº«ã€‚

<details>
<summary>`styles/_functions.scss`</summary>

```scss
// Tint a color: mix a color with white
@function tint-color($color, $weight) {
  @return mix(white, $color, $weight);
}

// Shade a color: mix a color with black
@function shade-color($color, $weight) {
  @return mix(black, $color, $weight);
}
```

</details>

<details>
<summary>`styles/_variables.scss`</summary>

```scss
@import 'functions';

@mixin use-css-variables() {
  // ===============================================
  // Size
  // ===============================================
  $css-variable-prefix-size: size-;

  $size-base: 28rpx; // é»˜è®¤
  $size-master: 36rpx; // æœ€é«˜çº§æ ‡é¢˜ã€ç”¨æˆ·åã€tab é€‰ä¸­ç­‰
  $size-title: 32rpx; // æ ‡é¢˜ã€tab æœªé€‰ä¸­ç­‰
  $size-secondary: 24rpx; // æç¤ºã€æ¬¡çº§æ–‡å­—ã€æ¬¡çº§æŒ‰é’®ç­‰
  $size-label: 22rpx; // æ ‡ç­¾ã€æ—¥æœŸã€ç‚¹èµæ•°é‡ã€æç¤ºç­‰

  $special-sizes: (
    'base': $size-base,
    'master': $size-master,
    'title': $size-title,
    'secondary': $size-secondary,
    'label': $size-label,
  );

  @each $size, $value in $special-sizes {
    --#{$css-variable-prefix-size}#{$size}: #{$value};
  }

  // ===============================================
  // Color
  // ===============================================
  $css-variable-prefix-color: color-;

  // ========== Themes ==========
  $color-primary: #fbd45f;
  $color-gray: #888;
  $color-yellow: #f7dc00;
  $color-blue: #5a94e3;
  $color-red: #ee0a24;

  $theme-colors: (
    'primary': $color-primary,
    'gray': $color-gray,
    'blue': $color-blue,
    'red': $color-red,
    'yellow': $color-yellow,
  );

  @each $color, $value in $theme-colors {
    --#{$css-variable-prefix-color}#{$color}: #{$value};

    @for $i from 1 through 9 {
      @if $i<5 {
        --#{$css-variable-prefix-color}#{$color}-#{$i*100}: #{tint-color($value, 100% - $i * 20%)};
      } @else if $i == 5 {
        --#{$css-variable-prefix-color}#{$color}-#{$i*100}: #{$value};
      } @else {
        --#{$css-variable-prefix-color}#{$color}-#{$i*100}: #{shade-color($value, ($i - 5) * 20%)};
      }
    }
  }

  // ========== Others ==========
  $color-white: #fff;
  $color-black: #222;
  $color-ink: $color-black; // é»˜è®¤æ–‡å­—é¢œè‰²
  $color-ink-light: #333; // ç•¥è½»çš„æ–‡å­—é¢œè‰²
  $color-secondary: shade-color($color-gray, 40%); // æ¬¡çº§æ–‡å­—é¢œè‰²
  $color-label: tint-color($color-gray, 40%); // è¾…åŠ©æ–‡å­—ã€æ ‡ç­¾ã€æ—¥æœŸã€è¡¨å•å ä½ç¬¦ç­‰
  $color-link: $color-blue; // é“¾æ¥ã€å¯ç‚¹å‡»æ–‡å­—
  $color-bg: $color-white; // é»˜è®¤èƒŒæ™¯è‰²
  $color-bg-colored: #f9fafc; // éƒ¨åˆ†é¡µé¢ä½¿ç”¨çš„å¦ä¸€ç§èƒŒæ™¯è‰²
  $color-bg-blank: #f7f7f7; // å¡ç‰‡èƒŒæ™¯ã€ç©ºå›¾ç‰‡ç­‰ç©ºç™½åŒºåŸŸå¡«å……è‰²
  $color-divider: #ebedf0; // åˆ†å‰²çº¿ã€è¾¹æ¡†

  $base-colors: (
    'white': $color-white,
    'black': $color-black,
    'ink': $color-ink,
    'ink-light': $color-ink-light,
    'secondary': $color-secondary,
    'label': $color-label,
    'link': $color-link,
    'bg': $color-bg,
    'bg-colored': $color-bg-colored,
    'bg-blank': $color-bg-blank,
    'divider': $color-divider,
  );

  @each $color, $value in $base-colors {
    --#{$css-variable-prefix-color}#{$color}: #{$value};
  }
}
```

</details>

<details>
<summary>`styles/_reset.scss`</summary>

```scss
@import 'variables';

page {
  // å¼•å…¥é¡¹ç›®ä¸­éœ€è¦ä½¿ç”¨çš„ css å˜é‡
  @include use-css-variables();

  height: 100%;
  font-family:
    -apple-system,
    BlinkMacSystemFont,
    'Helvetica Neue',
    Helvetica,
    Segoe UI,
    Arial,
    Roboto,
    'PingFang SC',
    'Hiragino Sans GB',
    'Microsoft Yahei',
    sans-serif;
  font-size: var(--size-base);

  // ...
}

view {
  box-sizing: border-box;
}
```

</details>

<details>
<summary>é¡µé¢ä¸­ä½¿ç”¨</summary>

```scss
&-placeholder {
  font-size: 28rpx;
  color: var(--color-gray-300);
}
```

</details>

## å¼•å…¥ Stylelint å®ç°æ ·å¼ä»£ç æ£€æŸ¥

å°ç¨‹åºå¼•å…¥ Gulp å·¥ä½œæµåå°±å¯ä»¥æ„‰å¿«çš„ä½¿ç”¨ Scss ç¼–å†™æ ·å¼äº†ã€‚è€Œå½“æˆ‘é‡æ–°æ•´ç†æ ·å¼ä»£ç æ—¶æ‰å‘ç°é¡¹ç›®ä¸­çš„æ ·å¼ä»£ç é‡å·²ç»éå¸¸å¯è§‚ï¼Œæˆ‘ä»¬æœ€å¥½è¿›ä¸€æ­¥å¯¹æ ·å¼ä»£ç è¿›è¡Œè§„èŒƒï¼Œå› æ­¤æˆ‘ä¹Ÿåœ¨å°ç¨‹åºé¡¹ç›®ä¸­å¼•å…¥äº† Stylelintã€‚

ä¸ ESLint ç±»ä¼¼ï¼Œæˆ‘ä»¬åŒæ ·éœ€è¦åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.stylelintrc.js` å’Œ `.stylelintignore` è¿›è¡Œä¸€ç‚¹ç‚¹é…ç½®ã€‚

<details>
<summary>`.stylelintrc.js`</summary>

```javascript
module.exports = {
  extends: ['stylelint-config-standard', 'stylelint-config-recess-order'],
  plugins: ['stylelint-order'],
  rules: {
    'selector-type-no-unknown': [
      true,
      {
        ignoreTypes: ['page', 'scroll-view', 'block'],
      },
    ],
    'unit-no-unknown': [
      true,
      {
        ignoreUnits: ['rpx'],
      },
    ],
    'at-rule-no-unknown': [
      true,
      {
        ignoreAtRules: ['function', 'if', 'else', 'for', 'each', 'include', 'mixin', 'return'],
      },
    ],
    'no-empty-source': [true, { severity: 'warning' }],
  },
};
```

</details>

> ğŸ’¡ å…³äº Stylelint æˆ‘æœ‰ä¸€ç¯‡æ›´è¯¦ç»†çš„æ–‡ç« ï¼š[ä½¿ç”¨ Stylelint è§„èŒƒæ ·å¼ä»£ç ](https://www.notion.so/daf5144155274fcab73bcb1615d57093) ã€‚

## å¼•å…¥åˆ†åŒ…æœºåˆ¶

åœ¨é¡¹ç›®è¿­ä»£ä¸¤ä¸ªå¤§ç‰ˆæœ¬åï¼Œå°ç¨‹åºä½“ç§¯å·²ç»è¾¾åˆ°äº† 985KB å·¦å³ï¼Œå¯¹äºä½“ç§¯çš„ä¼˜åŒ–è¿«åœ¨çœ‰ç«ã€‚ä»”ç»†åˆ†æå‘ç°ï¼Œå…‰æ˜¯ç”¨äºè§£æå¯Œæ–‡æœ¬çš„ towxml ä¾èµ–å°±å äº† 337KBï¼Œè€Œè¿™ä¸ªåŠŸèƒ½çš„ä½¿ç”¨é¢‘ç‡å®é™…ä¸Šéå¸¸ä½ã€‚

å› æ­¤è¿‘æœŸå°ç¨‹åºå°†ä½¿ç”¨åˆ°å¯Œæ–‡æœ¬çš„æ¨¡å—å’Œç§¯åˆ†å•†åŸæ¨¡å—è¿›è¡Œæ‹†åˆ†ï¼Œä½¿ç”¨äº†[å°ç¨‹åºåˆ†åŒ…æœºåˆ¶](https://developers.weixin.qq.com/miniprogram/dev/framework/subpackages/basic.html)ã€‚ä½¿ç”¨åˆ†åŒ…åï¼Œå°ç¨‹åºä¸»åŒ…ä½“ç§¯ä¸‹é™è‡³ 631KBã€‚æœªæ¥çš„é¡¹ç›®å¼€å‘ä¸­ï¼Œä¹Ÿåº”è¯¥ç§¯æè€ƒè™‘ä½¿ç”¨å°ç¨‹åºåˆ†åŒ…æŠ€æœ¯ï¼Œä¼˜åŒ–ç”¨æˆ·é¦–æ¬¡æ‰“å¼€ä½“éªŒã€‚
